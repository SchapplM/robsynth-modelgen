r2rpy := proc (R) 
  local rpy, sr, cr: 
  rpy := Matrix(3,1):

  rpy(1,1) := %arctan(-R(2,3), R(3,3)): # roll
  # compute sin/cos of roll angle
  sr := sin(rpy(1,1)):
  cr := cos(rpy(1,1)):

  rpy(2,1) := %arctan(R(1,3), cr * R(3,3) - sr * R(2,3));  # pitch
  rpy(3,1) := %arctan(-R(1,2), R(1,1));        # yaw

  return rpy:
end proc:
 
